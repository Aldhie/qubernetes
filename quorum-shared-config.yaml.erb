<%-
 @Permissioned_Nodes_File    = @config["quorum"]["Permissioned_Nodes_File"]
 @Genesis_File               = @config["quorum"]["Genesis_File"]
 @Tessera_Config_Dir         = @config["quorum"]["tm"]["Tessera_Config_Dir"]
%>

<%- if @Namespace != "" %>
apiVersion: v1
kind: Namespace
metadata:
  name: <%= @config["namespace"]["name"] %>
  labels:
    name: <%= @config["namespace"]["name"] %>
<%- end %>
---
# kubectl create configmap game-config --from-file=configure-pod-container/dd1/key
apiVersion: v1
kind: ConfigMap
metadata:
  name: quorum-permissioned-config
  <%= @Namespace %>
  labels:
    app: qubernetes
    name: quorum-permissioned-config
data:
  permissioned-nodes.json: |

<%- File.readlines(@Permissioned_Nodes_File).each do |line| -%>
    <%= line -%>
<% end -%>

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: genesis-config
  <%= @Namespace %>
  labels:
    app: qubernetes
    name: genesis-config
data:
  genesis-geth.json: |-
<%- File.readlines(@Genesis_File).each do |line| -%>
    <%= line -%>
<% end -%>

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: tessera-config
  <%= @Namespace %>
  labels:
    app: qubernetes
    name: tessera-config
data:
  tessera-config.json.tmpl: |-
<%- File.readlines(@Tessera_Config_Dir + "/tessera-config.json").each do |line| -%>
    <%= line -%>
<% end -%>

  tessera-config-enhanced.json.tmpl: |-
<%- File.readlines(@Tessera_Config_Dir + "/tessera-config-enhanced.json").each do |line| -%>
    <%= line -%>
<% end -%>
  tessera-config-9.0.json.tmpl: |-
<%- File.readlines(@Tessera_Config_Dir + "/tessera-config-9.0.json").each do |line| -%>
    <%= line -%>
<% end -%>

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: contracts-config
  <%= @Namespace %>
  labels:
    app: qubernetes
    name: contracts-config
data:
  runscript.sh: |-
<%- File.readlines("contracts/runscript.sh").each do |line| -%>
    <%= line -%>
<% end -%>
# TODO: replace "%TM_7_PK%" with actual node 7 tm pk key
  private_contract.js: |-
<%- File.readlines("contracts/private_contract.js").each do |line| -%>
    <%= line -%>
<% end -%>
  public_contract.js: |-
<%- File.readlines("contracts/public_contract.js").each do |line| -%>
    <%= line -%>
<% end -%>
